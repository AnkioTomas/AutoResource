# 短信识别

> 短信识别功能不需要添加任何app到xposed框架，授予自动记账短信相关的权限即可。

!>如果无法成功拦截短信（不是无法识别），就是日志里面没有收到短信相关的信息。请在收到短信后的5分钟内连上电脑，adb执行以下命令并复制输出内容发送邮件至dream@dreamn.cn，标题注明短信识别并附上手机型号。如果超时了，可以请别人朝你的手机发送短信，在你手机收到短信后再执行下面的命令。

```shell
adb shell dumpsys activity | grep BroadcastRecord
```

?> 已知MIUI的网络短信是无法捕获到的。个人感觉这个没必要。

# 规则编辑

- 规则名称：用于标记该规则的识别的内容

- 正则表达式：用于匹配短信

  - 常用标记符号`.*`表示匹配任意字符但不分组（就是说这个只能满足格式）。`(.*)`表示匹配并分组（就是说除了匹配到还会单独将匹配内容拎出来）

  - 举个例子： 

    > 原文：   王二今天打了一壶酒和两桶水。
    >
    > 规则：   王二`.*`打了一`(.*)`酒和(.*)桶水。
    >
    > 匹配：   匹配成功。并且第1个分组内容为`壶`,第2个分组内容为`两`

  - 其他注意事项，参见[自动分类 - 正则注意](自动分类#正则注意：)

- 匹配项目所在位置：就和例子中说的一样，第一个括号所在位置就填1，以此类推。如果此处不填数字或者数字值大于内容中括号数量表示直接填充内容。

  - 尾号：表示银行卡尾号，建议使用正则匹配。
  - 账户名称1：这个可以直接填写中国银行之类的。
  - 账户名称2：在发生转账或者信用还款的时候的第二个账户
  - 收支类型：仅支持收入、支出。
  - 后台交易：这个是不是后台进行的交易（短信一般是是）
  - 金额：使用正则匹配。
  - 商户名称：匹配到的商户名（一般中中括号里面的就行）
  - 商户备注：一些备注信息。

# 测试

## 规则测试

直接点测试按钮，输入短信测试。如果提示出错，说明正则表达式有问题。

## 短信测试

可以用另外的手机模拟发银行短信测试（会产生短信费用）