---
title: 环境配置
date: 2021-12-31 00:19:08
permalink: /pages/91eea5/
article: false
---
我们提到，自动记账有两种模式
::: note 模式
[无障碍模式](#无障碍模式) <br>
[Xposed模式](#xposed模式)<font color="#848589">（推荐）</font>
:::

## 无障碍模式
`无障碍模式`使用的是安卓系统自带的无障碍服务，该功能原本是方便残障人士使用手机的。我们通过这个服务来读取通知及屏幕内容来实现自动记账，不过该模式**高度依赖屏幕内容及App通知**，因此功能上**将会有不可避免的缺陷**。

无障碍模式是所有安卓机器都可以使用的，但是使用效果没有Xposed那么好，在手机可以解锁/Root/刷入Magisk的情况下，我们建议使用Xposed模式。


::: tip 配置教程

1. **下载并安装[自动记账](https://www.coolapk.com/apk/cn.dreamn.qianji_auto)**

2. 进行[记账应用配置](02.记账应用配置.md)

:::


## Xposed模式
::: tip
　`Xposed模式`，是我们**主要推荐**的模式。主要依赖于`Xposed框架`运行。因此，使用该模式<font color="#ff7733">**需要一定的基础**</font>。至少能够懂得一些常规的搞机知识，比如：<br/>
☞　**什么是**`刷机`**？**<br/>
☞　**什么是**`root`**？**<br/>
☞　**什么是**`面具(Magisk)`**？**<br/>
☞　**什么是**`xp框架`**？**<br/>
☞　**什么是**`模块`**？**<br/>
如果这些你都不清楚，那么**请至少学会**[百度](http://www.baidu.com)。
:::

-----
在开始准备工作之前，我们可能需要了解下目前存在的几种框架：([什么玩意？爷需要你来教？直接跳过！](#第一步、root))

#### 原生框架——深度集成到系统中的框架
::: note 原生框架
1. `原生Xposed框架`：⭐<br/>
   最为古老的框架，是所有xp框架的起源，现在已经停止维护(仅支持**Android8及以下**的版本)，并逐渐退出历史舞台，除非你是使用非常老旧的机器，否则可以忽略它。
2. `EdXposed`：⭐⭐<br/>
   简称`edxp`。Xposed基础上发展来的分支，依赖于`Magisk`以及`riru模块`，安装的便捷性上是优于原版的，但性能上并没有大的改进，卡顿等问题依旧存在，严重影响性能，因此，如果不是需要使用一些很偏门的模块，这个我们**并不推荐**。
3. `LSPosed`：⭐⭐⭐⭐⭐<br/>
   从`edxp`基础上发展来的新分支，同样是依赖于`magisk`和`riru`，针对`edxp`的痛点问题（卡顿、全局hook等）有了较明显的改进，因而口碑较好。因此，我们<font color="#ff8833">**强烈推荐**</font>使用LSP（如果条件允许的话）。<br/>
   另外，**需要说明的是**，lsp已经**彻底放弃**了对`安卓8.0及以下`的支持，安卓8.0及以下的用户可以放弃对它的期待。
4. `太极-阳`：⭐⭐⭐⭐<br/>
   太极的root模式，性能介于`edxp`和`LSPosed`之间。流畅，但没有完全流畅。在LSP横空出世前，他几乎是最优的选择了。目前维护者**weishu**似乎停更了。
5. `轮回`：⭐⭐⭐⭐⭐<br/>
   自动记账官方作品，基于Frida开发，是一种和Xposed完全不一样的hook方案。目前还在开发阶段，不对外公开。
:::
#### 虚拟框架——未Root手机使用XPosed模块
::: note 虚拟框架
1. `太极-阴`：⭐⭐⭐<br/>
   一款支持免root的框架，性能介于edxp和lsp之间。如果手机不能root，可以考虑使用。但我们并不推荐，因为**支付宝不支持加入太极**。这意味着我们要自废一半功力。目前维护者**weishu**似乎停更了。
2. `应用转生`：⭐⭐<br/>
   同样是免root框架，但它同时支持支付宝和微信，虽然稳定性、性能等方面都不如太极。此框架**不推荐**，原因在于最新版集成的Xposed类是比较古老的，以至于新的特性无法正常使用。
3. `神之手`：⭐⭐<br/>
   参考`应用转生`，实现方案类似。
4. `Xpatch`：⭐⭐<br/>
   直接将Xposed和模块打包到了目标应用中，与原生框架效果类似，但是已经长期未更新。
5. `Lspatch`：⭐⭐⭐<br/>
   LSPosed团队的作品，衍生自`Xpatch`，不过目前还处于测试阶段，根据LSPosed团队介绍，后期会出一个类似于`应用转生`一样的免root框架管理器，唯一的缺点是打包后应用体积是Lsp框架+模块+目标App。
:::

----
<font size="3">下面正式开始：</font>


### 第一步、ROOT

这一步<font size="3">**并非必须的**</font>，使用[虚拟框架](#虚拟框架-未root手机使用xposed模块)的用户可以[<font color="#ff7733">忽略这一步</font>](#虚拟框架-非root用户)，而使用[原生框架](#原生框架——深度集成到系统中的框架)的用户，请继续往下看：

::: tip 通用root流程
1. [解锁bootloader](https://zhuanlan.zhihu.com/p/141877119),不是所有的手机厂商都支持，比如华为就不支持。
2. 刷入第三方Recovery，如[TWRP](https://twrp.me/)、[OrangeFox](https://orangefox.download/zh-CN),如果没有找到你的机器型号，请看第4步。
3. 我们刷完Recovery后，进入Recovery，刷入[Magisk](https://www.coolapk.com/apk/com.topjohnwu.magisk)卡刷包(最新版Magisk Manager安装包后缀改成zip)，即可获得Root权限。教程结束。
4. 如果没有Recovery，我们需要通过修补boot的方式来实现Root，详细教程请参考[bilibili](https://www.bilibili.com/video/av713518781)
:::

::: warning
由于每个机型、品牌的root流程都不一样，所以这一步的工作，只能请大家自行寻找方案。<br/>
如果你使用的是`一加手机`，可以前往[这个链接](https://optool.daxiaamu.com/wiki/pctool.html)看看，结果如何<font size="4">**概不负责**</font>。
:::

root完成后，如果你是系统自带的root权限，那么，你需要将root权限替换成Magisk。
::: note 详细步骤
1. 下载并安装[Magisk Manager](https://www.coolapk.com/apk/com.topjohnwu.magisk)；
2. 打开`magisk`，并给予`Root权限`；
3. 点击`magisk旁边`的`安装`>`直接安装`；
4. 完成后`重启手机`。
:::

### 第二步、安装框架
为方便大家查找，这里设置几个跳转链接：
- [非root用户](#虚拟框架-非root用户)
- [老旧机型专属（原生Xp框架）](#原生xposed框架-老旧机型专供)
- [Root用户](#magisk框架-root用户专供)

::: warning 
Xp框架建议只安装一个，不要多个同时安装，虽然它们可以共存，但是使用时可能存在某些不可预料的冲突。
:::

#### 虚拟框架(非ROOT用户)：
::: tip 操作流程
1. 下载并安装[`虚拟框架`](/pages/8cde3f/#免root框架)，无需重启手机；
2. 进入虚拟框架，更新并安装好框架包，这里只需要按照提示进行就好。
3. 到这里，就可以进入[下一步](#第三步、激活模块)了。
:::

#### 原生Xposed框架（老旧机型专供）： 
::: danger
由于原生Xp框架已经停止维护了，所以除非是非常老旧的机型，一般情况下我们并不推荐使用它：
:::

它的安装操作非常繁琐，而且由于年代久远，没法找到配图，安装过程只能进行文字性的叙述：
::: tip 操作流程
1. 解锁你的手机。然后通过论坛、百度或其他方式找到适合你机型的第三方recovery，最好是`TWRP`(`Team Win Recovery Project`)。然后通过线刷的方式，刷入你的设备；
2. 找到适合你当前手机系统的[Xposed框架包](https://dl-xda.xposed.info/framework)。没错，不同的机型，不同的系统，需要的框架包甚至可能存在差异；
3. 进入开发者选项，打开高级重启；
4. 长按开机键，重启到`recovery（恢复模式）`；
5. 进入TWRP后，点击安装，找到你的框架包，刷入；
6. 重启手机。
7. 开机后，看到桌面上多了一个`Xposed`App，这说明你已经成功了;
8. 打开，并给于`Root权限`，[大功告成](#第三步、激活模块)！
:::

#### Magisk框架(Root用户专供)：

看到了这里，相信大家都已经成功Root，并在手机上安装好了Magisk。如果没有，那么请回到[上一步](#第一步、root)。

下面开始安装框架，这里以LSP为例，其他两个类同：
::: warning
Magisk目前已经放弃维护模块仓库，建议使用[搞机助手](/pages/8cde3f/#搞机助手)一键安装。
:::
::: tip
1. 打开`Magisk`，点击底栏第四个图标;<br/>
:::

::: center
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_10_54_40_1641005680_1641005680082_N5Jb26.png' alt='2022_01_01_10_54_40_1641005680_1641005680082_N5Jb26' style="width:200px"/>
:::

::: tip
2. 进入模块页面后点击搜索按钮，输入`riru`，会自动出来一长串列表，我们需要的是图上这两个：<br/>
:::

<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_10_55_29_1641005729_1641005729985_5vruIH.png' alt='2022_01_01_10_55_29_1641005729_1641005729985_5vruIH' style="width:32%"/>
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_10_55_59_1641005759_1641005759573_XkxTgB.png' alt='2022_01_01_10_55_59_1641005759_1641005759573_XkxTgB' style="width:32%"/>
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_10_56_21_1641005781_1641005781382_M0Gbd2.png' alt='2022_01_01_10_56_21_1641005781_1641005781382_M0Gbd2' style="width:32%"/>

::: tip 
3.点击下载=>安装，等待自动安装完成:<br/>
:::
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_21_25_35_1641043535_1641043535993_92lH9R.png' alt='2022_01_01_21_25_35_1641043535_1641043535993_92lH9R' width=32%/>
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_21_27_29_1641043649_1641043649540_D3dsfo.png' alt='2022_01_01_21_27_29_1641043649_1641043649540_D3dsfo' width=32%/>
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_21_27_44_1641043664_1641043664536_TmYLQx.jpg' alt='2022_01_01_21_27_44_1641043664_1641043664536_TmYLQx' width=32%/>

::: tip
4.安装完一个后，先不要重启，退出来安装第二个，全部安装完成后重启手机<br/>
::: 

::: center
<img src='https://cdn.jsdelivr.net/gh/dreamncn/picBed@master/uPic/2022_01_01_21_27_59_1641043679_1641043679683_sfI847.png' alt='2022_01_01_21_27_59_1641043679_1641043679683_sfI847' width=260/>
:::
::: warning
原生框架除了需要安装Riru模块以外还需要管理器，[框架管理器](/pages/8cde3f/#lsposed框架)可以从这里找到。
:::
 
### 第三步、激活模块
下载并安装[自动记账](https://www.coolapk.com/apk/cn.dreamn.qianji_auto)。

::: details 原生Xposed和EdXposed激活方法
1. 打开`Xposed管理器`（`EdXposed管理器`），进入模块页面；
2. 激活`自动记账`模块；
3. 重启手机。
:::

::: details Lsposed框架/太极阳激活方法 
<div class="custom-block note">
应用更新后，请参考<a href="#作用域说明">作用域</a>中的生效方法，自行决定如何使模块生效。
</div>

1. 打开`LSPosed`，点击模块，进入模块页面；
2. 找到`自动记账`，点进去；
3. 点进去后会看到一长串的应用列表，最上方有个`开关`，打开它；
4. 一般来说LSP会自动勾选[作用域](#作用域说明)，**不要**自作聪明取消勾选，就这样悄悄地退出去；
5. 结束运行上面的应用，无需重启手机;
6. 重新打开对应App，进入`设置`，如果多出一条`自动记账`的选项，那么恭喜你，成功了！
:::

::: details 太极阴或其他虚拟框架激活方法
<div class="custom-block danger">
虚拟框架不支持转生系统应用(System)，只可以转生用户应用(User),系统类应用在<a href="/pages/cc8aae/">权限设置</a>处有替代方案。
</div>

<div class="custom-block note">
应用更新后，请参考<a href="#作用域说明">作用域</a>中的生效方法，自行决定如何使模块生效。
</div>

1. 点击右下角浮动按钮，然后选择`创建应用`。
2. 在`创建应用`界面中，选择[作用域](#作用域说明)中的App，然后点击最下方的按钮`创建`。
3. 耐心等待应用创建完成，并卸载原有的APP再安装创建后的APP。（这个过程可能会很长，取决于你手机CPU的好坏）
4. 在太极主页右下角浮动按钮，选择`模块管理`；然后勾选`自动记账`。
5. 结束运行上面的应用;
6. 重新打开对应App，进入`设置`，如果多出一条`自动记账`的选项，那么恭喜你，成功了！
:::

#### 作用域说明
| 包名 | App名称 |类型|说明| 生效方法 |
|  :---: | :---: | :---: | :---: | :---: |
| android | 安卓系统|System|hook系统权限|重新启动|
| com.android.phone | 电话服务|System |读取短信|强行停止|
| com.mutangtech.qianji | 钱迹|User |用于进行数据同步、实现自动记账报销|强行停止|
| com.tencent.mm | 微信|User |读取微信账单信息|强行停止|
| com.eg.android.AlipayGphone | 支付宝|User |读取支付宝账单|强行停止|
| com.tencent.mobileqq | QQ|User |读取QQ账单|强行停止|
| com.xiaomi.xmsf | 小米服务框架|System |读取通过小米统一推送服务推送的通知|强行停止|
::: warning 关于通知读取的说明
 想要截取哪个App发出的通知就在作用域中勾选那个App,并在自动记账的监控列表中选择对应的应用。

 此处的【小米服务框架】是统一推送服务框架，其他机型请勾选对应推送框架。
:::
::: tip 举个栗子🌰
1. QQ的消息通知不走统一推送，我想要监控QQ通知，则需要作用域勾选【QQ】,并在自动记账列表中选中QQ。

2. 云闪付的消息通知走统一推送（小米服务框架），我想要监控云闪付通知，则需要作用域勾选【小米服务框架】，并在自动记账监控列表中选中【云闪付】
:::

到这里为止，所有的准备工作就已经全部做完了。下面开始[进入正式教程](02.记账应用配置.md)


<Vssue :title="$title" />